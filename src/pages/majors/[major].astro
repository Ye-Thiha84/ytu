---
import MainLayout from "../../layouts/MainLayout.astro";
import supabase from '../../utils/supabaseClient.js';

// Define getStaticPaths to generate all possible routes
export async function getStaticPaths() {
  const { data: majors, error } = await supabase
    .from('majors')
    .select('slug');

  if (error) {
    console.error('Error fetching majors for static paths:', error);
    return [];
  }

  return majors.map((major) => ({
    params: { major: major.slug }
  }));
}

// Get the major from the URL parameter
const { major } = Astro.params;

// Fetch the data for the selected major
const { data: majorData, error } = await supabase
  .from('majors')
  .select('*')
  .eq('slug', major)
  .single();

if (error || !majorData) {
  return new Response("Major not found", { status: 404 });
}
---

<MainLayout>
  <section class="major-details">
    <h1>{majorData.title}</h1>
    <p class="description">{majorData.description}</p>

    <h2>Key Topics</h2>
    <ul class="topics-list">
      {majorData.key_topics.map((topic) => (
        <li>{topic}</li>
      ))}
    </ul>

    <h2>Career Prospects</h2>
    <ul class="career-list">
      {majorData.career_prospects.map((career) => (
        <li>{career}</li>
      ))}
    </ul>

    <a href="/maj" class="back-btn">Back to Majors</a>
  </section>

  <style>
    .major-details {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
      color: var(--text-color);
      background-color: var(--bg-color);
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    .description {
      font-size: 1.2rem;
      margin-bottom: 2rem;
      line-height: 1.6;
    }

    h2 {
      font-size: 1.8rem;
      margin-top: 1.5rem;
      margin-bottom: 0.8rem;
    }

    .topics-list,
    .career-list {
      list-style-type: disc;
      padding-left: 2rem;
      margin-bottom: 2rem;
    }

    .topics-list li,
    .career-list li {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .back-btn {
      display: inline-block;
      padding: 0.5rem 1rem;
      background-color: #ffffff;
      color: var(--bg-color);
      text-decoration: none;
      border-radius: 5px;
      font-weight: bold;
      transition: background-color 0.2s ease;
    }

    .back-btn:hover {
      background-color: #e0e0e0;
    }
  </style>
</MainLayout>